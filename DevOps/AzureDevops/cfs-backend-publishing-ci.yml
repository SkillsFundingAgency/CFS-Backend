name: $(Rev:r)

pool:
  vmImage: windows-2019

resources:
  repositories:
  - repository: self
  - repository: funding-blocks
    type: github
    name: SkillsFundingAgency/funding-platform-building-blocks
    ref: refs/heads/master
    endpoint: 'Github (ESFA)'

trigger:
  branches:
    include:
    - providers
    - fdps
  paths:
    include:
    - CalculateFunding.Api.Publishing
    - CalculateFunding.Functions.Publishing
    - CalculateFunding.Services.Publishing
    - CalculateFunding.Services.Publishing.UnitTests
    - CalculateFunding.Services.Core
    - Devops/search-indexes/publishedfundingindex
    - Devops/search-indexes/publishedproviderindex
    - CalculateFunding.Generators.Schema10
    - CalculateFunding.Generators
    - CalculateFunding.Models.Search
    - CalculateFunding.Models.Versioning
    - CalculateFunding.Models.ProviderLegacy
    - CalculateFunding.Models.Publishing
    - CalculateFunding.Models.External
    
variables:
 - name: ProjectName
   value: 'Publishing'
 - name: BuildApi
   value: true
 - name: BuildFunction
   value: true
 - name: DOTNET_SKIP_FIRST_TIME_EXPERIENCE
   value: '1'
 - name: DOTNET_CLI_TELEMETRY_OPTOUT
   value: '1'
 - group: 'Dotnet Core SDK Version'


steps:
- template: azure-pipelines-templates/cfs/standard-service-ci-build.yml@funding-blocks
  parameters:
    ProjectName: $(ProjectName)
    DotnetCoreSdkVersion: $(DotnetCoreSdkVersion)
    BuildApi: ${{ variables.BuildApi }}
    BuildFunction: ${{ variables.BuildFunction }}
    